<!DOCTYPE html>
<html>
<head>
    <title>ELM Debug Console Output</title>
    <style>
        body { font-family: monospace; margin: 20px; background: #1e1e1e; color: #fff; }
        .log { background: #2d2d2d; padding: 5px; margin: 2px 0; border-left: 3px solid #666; }
        .error { border-left-color: #ff6b6b; background: #4a1f1f; }
        .success { border-left-color: #51cf66; background: #1f4a2a; }
        .warn { border-left-color: #ffd43b; background: #4a4a1f; }
        #elm-container { border: 2px solid #666; min-height: 300px; padding: 20px; margin: 20px 0; background: #333; }
        .test-section { border: 1px solid #555; margin: 10px 0; padding: 10px; }
    </style>
</head>
<body>
    <h1>ELM Debug Console Output</h1>
    
    <div id="console-output">
        Console output will appear here...
    </div>
    
    <div class="test-section">
        <h3>Test Results:</h3>
        <div id="test-results">No tests run yet</div>
    </div>
    
    <div id="elm-container">
        ELM app attempts will appear here
    </div>
    
    <script>
        // Capture console output
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToOutput(message, type = 'log') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            document.getElementById('console-output').appendChild(div);
            document.getElementById('console-output').scrollTop = document.getElementById('console-output').scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToOutput(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToOutput(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToOutput(args.join(' '), 'warn');
        };
        
        // Test different flag approaches
        function updateTestResults(test, result, error = null) {
            const div = document.getElementById('test-results');
            div.innerHTML += `<div class="${result === 'success' ? 'success' : 'error'}">${test}: ${result}${error ? ' - ' + error : ''}</div>`;
        }
        
        console.log('Starting ELM debug tests...');
        
        // Load the ELM script
        const script = document.createElement('script');
        script.src = './public/elm/kompost.js';
        
        script.onload = function() {
            console.log('ELM script loaded successfully');
            
            setTimeout(() => {
                console.log('Checking window.Elm availability...');
                console.log('typeof window.Elm:', typeof window.Elm);
                console.log('window.Elm:', window.Elm);
                
                if (window.Elm && window.Elm.Main && typeof window.Elm.Main.init === 'function') {
                    console.log('window.Elm.Main.init is available');
                    
                    // Test 1: No flags
                    try {
                        console.log('TEST 1: No flags');
                        const container1 = document.createElement('div');
                        container1.style.border = '1px solid red';
                        container1.style.height = '100px';
                        container1.textContent = 'Test 1 container';
                        document.getElementById('elm-container').appendChild(container1);
                        
                        const app1 = window.Elm.Main.init({
                            node: container1
                        });
                        
                        console.log('SUCCESS: No flags worked!', app1);
                        updateTestResults('No flags', 'success');
                        
                    } catch (error1) {
                        console.error('FAILED: No flags -', error1.message);
                        updateTestResults('No flags', 'failed', error1.message);
                        
                        // Test 2: Null flags
                        try {
                            console.log('TEST 2: Null flags');
                            const container2 = document.createElement('div');
                            container2.style.border = '1px solid blue';
                            container2.style.height = '100px';
                            container2.textContent = 'Test 2 container';
                            document.getElementById('elm-container').appendChild(container2);
                            
                            const app2 = window.Elm.Main.init({
                                node: container2,
                                flags: null
                            });
                            
                            console.log('SUCCESS: Null flags worked!', app2);
                            updateTestResults('Null flags', 'success');
                            
                        } catch (error2) {
                            console.error('FAILED: Null flags -', error2.message);
                            updateTestResults('Null flags', 'failed', error2.message);
                            
                            // Test 3: Empty string
                            try {
                                console.log('TEST 3: Empty string flags');
                                const container3 = document.createElement('div');
                                container3.style.border = '1px solid green';
                                container3.style.height = '100px';
                                container3.textContent = 'Test 3 container';
                                document.getElementById('elm-container').appendChild(container3);
                                
                                const app3 = window.Elm.Main.init({
                                    node: container3,
                                    flags: ""
                                });
                                
                                console.log('SUCCESS: Empty string flags worked!', app3);
                                updateTestResults('Empty string', 'success');
                                
                            } catch (error3) {
                                console.error('FAILED: Empty string flags -', error3.message);
                                updateTestResults('Empty string', 'failed', error3.message);
                                
                                // Test 4: Simple string
                                try {
                                    console.log('TEST 4: Simple string flags');
                                    const container4 = document.createElement('div');
                                    container4.style.border = '1px solid yellow';
                                    container4.style.height = '100px';
                                    container4.textContent = 'Test 4 container';
                                    document.getElementById('elm-container').appendChild(container4);
                                    
                                    const app4 = window.Elm.Main.init({
                                        node: container4,
                                        flags: "simple-string"
                                    });
                                    
                                    console.log('SUCCESS: Simple string flags worked!', app4);
                                    updateTestResults('Simple string', 'success');
                                    
                                } catch (error4) {
                                    console.error('FAILED: Simple string flags -', error4.message);
                                    updateTestResults('Simple string', 'failed', error4.message);
                                    console.error('ALL TESTS FAILED - There may be a deeper issue with the ELM app');
                                }
                            }
                        }
                    }
                } else {
                    console.error('window.Elm.Main.init is not available');
                    updateTestResults('ELM availability', 'failed', 'window.Elm.Main.init not found');
                }
            }, 1000);
        };
        
        script.onerror = function() {
            console.error('Failed to load ELM script');
            updateTestResults('Script loading', 'failed', 'Could not load script');
        };
        
        document.head.appendChild(script);
    </script>
</body>
</html>